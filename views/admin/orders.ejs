<div class="container mx-auto p-6">
  <h1 class="text-2xl font-bold mb-6 text-primary">All Orders</h1>

  <div class="flex justify-between items-center mb-4">
    <input id="searchInput" type="text" placeholder="Search by OrderID" class="border rounded px-3 py-1 w-64" />
    <div>
      <button onclick="performSearch()" class="bg-[#007D8B] text-white px-3 py-1 rounded hover:opacity-90">Search</button>
      <button onclick="clearSearch()" class="bg-gray-200 text-black px-3 py-1 rounded">Clear</button>
    </div>
  </div>

  <% if (orders.length > 0) { %>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white shadow-md rounded-lg overflow-hidden text-sm">
        <thead class="bg-gray-100 text-left text-gray-700">
          <tr>
            <th class="px-4 py-3">Order ID</th>
            <th class="px-4 py-3">Date</th>
            <th class="px-4 py-3">User</th>
            <th class="px-4 py-3">Amount</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3">Actions</th>
          </tr>
        </thead>
        <tbody id="orderBody">
          <% orders.forEach(order => { %>
            <tr class="border-b hover:bg-gray-50">
              <td class="px-4 py-3"><%= order.orderId %></td>
              <td class="px-4 py-3"><%= new Date(order.createdAt).toLocaleDateString() %></td>
              <td class="px-4 py-3"><%= order.user?.name %> <br> <small class="text-gray-500"><%= order.user?.email %></small></td>
              <td class="px-4 py-3 font-semibold">₹<%= order.totalAmount.toFixed(2) %></td>
              <td class="px-4 py-3">
                <span class="inline-block px-2 py-1 rounded text-white
                  <% if (order.status === 'Pending') { %> bg-yellow-500
                    <% } else if (order.status === 'Placed') { %> bg-yellow-300
                  <% } else if (order.status === 'Shipped') { %> bg-blue-400
                  <% } else if (order.status === 'Out for Delivery') { %> bg-green-600
                  <% } else if (order.status === 'Delivered') { %> bg-lime-400
                  <% } else if (order.status === 'Failed') { %> bg-gray-400
                  <% } else if (order.status === 'Returned') { %> bg-orange-500
                  <% } else if (order.status === 'Cancelled') { %> bg-red-500 <% } %>">
                  <%= order.status %>
                </span>
              </td>
              <td class="px-4 py-3">
                <a href="/admin/orders/<%= order._id %>" class="text-primary hover:underline">View</a>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } else { %>
    <p class="text-gray-600">No orders available.</p>
  <% } %>

  <div class="flex justify-center mt-6 space-x-2" id="paginationControls">
    <!-- Pagination buttons will be generated by JS -->
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    async function performPagination(page = 1){
      const query = document.getElementById('searchInput').value;
      const response = await fetch(`/admin/order-pagination?page=${page}&query=${encodeURIComponent(query)}`);
      const data = await response.json();
      
      if(data.success){
        const tbody = document.getElementById('orderBody');
        tbody.innerHTML='';

        data.orders.forEach(order => {
          tbody.innerHTML += `
            <tr class="border-b hover:bg-gray-50">
              <td class="px-4 py-3">${order.orderId}</td>
              <td class="px-4 py-3">${new Date(order.createdAt).toLocaleDateString()}</td>
              <td class="px-4 py-3">${order.user?.name || ''} <br> <small class="text-gray-500">${order.user?.email || ''}</small></td>
              <td class="px-4 py-3 font-semibold">₹${order.totalAmount.toFixed(2)}</td>
              <td class="px-4 py-3">
                <span class="inline-block px-2 py-1 rounded text-white ${getStatusColor(order.status)}">
                  ${order.status}
                </span>
              </td>
              <td class="px-4 py-3">
                <a href="/admin/orders/${order._id}" class="text-primary hover:underline">View</a>
              </td>
            </tr>
          `;
        });
      }

      const paginationControls = document.getElementById('paginationControls');
      paginationControls.innerHTML = '';
      for(let i=1; i<=data.totalPages; i++){
        paginationControls.innerHTML +=`
        <button onclick="performPagination(${i})"
        class="px-3 py-1 rounded ${i === data.currentPage ? 'bg-[#007D8B] text-white':'bg-white border text-[#007D8B] hover:bg-[#007D8B] hover:text-white'}">
        ${i}
        </button>`;
      }
    }

    function performSearch() {
      performPagination(1);
    }

    function clearSearch() {
      document.getElementById('searchInput').value = '';
      performPagination(1);
    }

    function getStatusColor(status) {
      switch (status) {
        case 'Pending': return 'bg-yellow-500';
        case 'Placed': return 'bg-yellow-300';
        case 'Shipped': return 'bg-blue-400';
        case 'Out for Delivery': return 'bg-green-600';
        case 'Delivered': return 'bg-lime-400';
        case 'Failed': return 'bg-gray-400';
        case 'Returned': return 'bg-orange-500';
        case 'Cancelled': return 'bg-red-500';
        default: return 'bg-gray-300';
      }
    }


    window.onload = () => performPagination(1);
</script>

