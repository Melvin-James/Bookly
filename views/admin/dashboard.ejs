<div class="space-y-6">
  <!-- Dashboard Header -->
  <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <div class="bg-primary-light p-3 rounded-full">
          <i class="ri-dashboard-line text-2xl text-primary"></i>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-gray-800">Admin Dashboard</h1>
          <p class="text-gray-600">Welcome back! Here's what's happening with your bookstore.</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <button id="refreshDashboard" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-hover flex items-center gap-2">
          <i class="ri-refresh-line"></i>
          <span>Refresh</span>
        </button>
        <select id="dashboardPeriod" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30">
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month" selected>This Month</option>
          <option value="year">This Year</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Stats Overview Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-blue-500">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-sm text-gray-500 font-medium">Total Revenue</p>
          <h3 id="totalRevenue" class="text-2xl font-bold text-gray-800 mt-1">â‚¹0</h3>
          <p class="text-sm text-green-600 mt-1">
            <span id="revenueChange">+0%</span> from last period
          </p>
        </div>
        <div class="bg-blue-100 p-3 rounded-full">
          <i class="ri-money-dollar-circle-line text-blue-600 text-xl"></i>
        </div>
      </div>
    </div>
    
    <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-green-500">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-sm text-gray-500 font-medium">Total Orders</p>
          <h3 id="totalOrders" class="text-2xl font-bold text-gray-800 mt-1">0</h3>
          <p class="text-sm text-green-600 mt-1">
            <span id="ordersChange">+0%</span> from last period
          </p>
        </div>
        <div class="bg-green-100 p-3 rounded-full">
          <i class="ri-shopping-cart-line text-green-600 text-xl"></i>
        </div>
      </div>
    </div>
    
    <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-amber-500">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-sm text-gray-500 font-medium">Products Sold</p>
          <h3 id="productsSold" class="text-2xl font-bold text-gray-800 mt-1">0</h3>
          <p class="text-sm text-green-600 mt-1">
            <span id="productsChange">+0%</span> from last period
          </p>
        </div>
        <div class="bg-amber-100 p-3 rounded-full">
          <i class="ri-book-2-line text-amber-600 text-xl"></i>
        </div>
      </div>
    </div>
    
    <div class="bg-white p-6 rounded-lg shadow-sm border-l-4 border-primary">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-sm text-gray-500 font-medium">New Customers</p>
          <h3 id="newCustomers" class="text-2xl font-bold text-gray-800 mt-1">0</h3>
          <p class="text-sm text-green-600 mt-1">
            <span id="customersChange">+0%</span> from last period
          </p>
        </div>
        <div class="bg-primary-light p-3 rounded-full">
          <i class="ri-user-add-line text-primary text-xl"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Sales Chart Section -->
  <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
      <div>
        <h2 class="text-xl font-bold text-gray-800 mb-2">Sales Analytics</h2>
        <p class="text-gray-600">Track your sales performance over time</p>
      </div>
      <div class="flex flex-wrap gap-2 mt-4 md:mt-0">
        <button class="chart-filter-btn active" data-period="7">7 Days</button>
        <button class="chart-filter-btn" data-period="30">30 Days</button>
        <button class="chart-filter-btn" data-period="90">3 Months</button>
        <button class="chart-filter-btn" data-period="365">1 Year</button>
      </div>
    </div>
    
    <div class="relative h-80">
      <canvas id="salesChart"></canvas>
    </div>
  </div>

  <!-- Top Performance Section -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- Best Selling Products -->
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
          <i class="ri-book-2-line text-primary"></i>
          Top 10 Products
        </h3>
        <button class="text-primary hover:text-primary-hover text-sm font-medium">View All</button>
      </div>
      
      <div id="topProducts" class="space-y-3">
        <!-- Loading skeleton -->
        <div class="animate-pulse space-y-3">
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gray-200 rounded"></div>
              <div class="space-y-1">
                <div class="w-24 h-3 bg-gray-200 rounded"></div>
                <div class="w-16 h-2 bg-gray-200 rounded"></div>
              </div>
            </div>
            <div class="w-12 h-3 bg-gray-200 rounded"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Best Selling Categories -->
    <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
          <i class="ri-folder-line text-primary"></i>
          Top 10 Categories
        </h3>
        <button class="text-primary hover:text-primary-hover text-sm font-medium">View All</button>
      </div>
      
      <div id="topCategories" class="space-y-3">
        <!-- Loading skeleton -->
        <div class="animate-pulse space-y-3">
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gray-200 rounded"></div>
              <div class="space-y-1">
                <div class="w-20 h-3 bg-gray-200 rounded"></div>
                <div class="w-14 h-2 bg-gray-200 rounded"></div>
              </div>
            </div>
            <div class="w-12 h-3 bg-gray-200 rounded"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Best Selling Publishers -->
    <!-- <div class="bg-white rounded-lg shadow-sm p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
          <i class="ri-building-line text-primary"></i>
          Top 10 Publishers
        </h3>
        <button class="text-primary hover:text-primary-hover text-sm font-medium">View All</button>
      </div>
      
      <div id="topPublishers" class="space-y-3">
      
        <div class="animate-pulse space-y-3">
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 bg-gray-200 rounded"></div>
              <div class="space-y-1">
                <div class="w-24 h-3 bg-gray-200 rounded"></div>
                <div class="w-16 h-2 bg-gray-200 rounded"></div>
              </div>
            </div>
            <div class="w-12 h-3 bg-gray-200 rounded"></div>
          </div>
        </div>
      </div>
    </div> -->
  </div>

  <!-- Recent Activity -->
  <!-- <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
        <i class="ri-time-line text-primary"></i>
        Recent Activity
      </h3>
      <button class="text-primary hover:text-primary-hover text-sm font-medium">View All</button>
    </div>
    
    <div id="recentActivity" class="space-y-4">
      
    </div>
  </div> -->
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  let salesChart;

  initializeDashboard();

  document.querySelectorAll('.chart-filter-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      document.querySelectorAll('.chart-filter-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      updateSalesChart(this.dataset.period);
    });
  });

  document.getElementById('dashboardPeriod').addEventListener('change', function () {
    loadDashboardData(this.value);
  });

  document.getElementById('refreshDashboard').addEventListener('click', function () {
    const btn = this;
    btn.innerHTML = '<i class="ri-loader-4-line animate-spin"></i> Refreshing...';
    btn.disabled = true;
    setTimeout(() => {
      loadDashboardData();
      btn.innerHTML = '<i class="ri-refresh-line"></i> Refresh';
      btn.disabled = false;
    }, 1000);
  });

  function initializeDashboard() {
    initializeSalesChart();
    loadDashboardData();
    loadTopProducts();
    loadTopCategories();
    // loadTopPublishers();
    // loadRecentActivity();
  }

  function initializeSalesChart() {
    const ctx = document.getElementById('salesChart').getContext('2d');
    salesChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Revenue',
          data: [],
          borderColor: '#007D8B',
          backgroundColor: 'rgba(0, 125, 139, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#007D8B',
          pointBorderColor: '#ffffff',
          pointBorderWidth: 2,
          pointRadius: 6,
          pointHoverRadius: 8
        }, {
          label: 'Orders',
          data: [],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#10b981',
          pointBorderColor: '#ffffff',
          pointBorderWidth: 2,
          pointRadius: 6,
          pointHoverRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'top', labels: { usePointStyle: true, padding: 20 } },
          tooltip: {
            mode: 'index',
            intersect: false,
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            titleColor: '#ffffff',
            bodyColor: '#ffffff',
            borderColor: '#007D8B',
            borderWidth: 1
          }
        },
        scales: {
          x: {
            grid: { display: false },
            ticks: { color: '#6b7280' }
          },
          y: {
            grid: { color: 'rgba(0, 0, 0, 0.1)' },
            ticks: {
              color: '#6b7280',
              callback: function (value) {
                return 'â‚¹' + value.toLocaleString();
              }
            }
          }
        },
        interaction: {
          mode: 'nearest',
          axis: 'x',
          intersect: false
        }
      }
    });
  }

  function updateSalesChart(period = '30') {
    fetch(`/admin/sales-chart?period=${period}`)
      .then(response => response.json())
      .then(data => {
        salesChart.data.labels = data.labels;
        salesChart.data.datasets[0].data = data.revenue;
        salesChart.data.datasets[1].data = data.orders;
        salesChart.update('active');
      })
      .catch(console.error);
  }

  function loadDashboardData(period = 'month') {
    fetch(`/admin/dashboard/stats?period=${period}`)
      .then(response => response.json())
      .then(updateStatsCards)
      .catch(console.error);
  }

  function updateStatsCards(data) {
    document.getElementById('totalRevenue').textContent = 'â‚¹' + data.totalRevenue.toLocaleString();
    document.getElementById('revenueChange').textContent = (data.revenueChange > 0 ? '+' : '') + data.revenueChange + '%';

    document.getElementById('totalOrders').textContent = data.totalOrders.toLocaleString();
    document.getElementById('ordersChange').textContent = (data.ordersChange > 0 ? '+' : '') + data.ordersChange + '%';

    document.getElementById('productsSold').textContent = data.productsSold.toLocaleString();
    document.getElementById('productsChange').textContent = (data.productsChange > 0 ? '+' : '') + data.productsChange + '%';
  }

  function loadTopProducts() {
    fetch('/admin/top-products')
      .then(response => response.json())
      .then(data => renderTopItems('topProducts', data, 'product'))
      .catch(console.error);
  }

  function loadTopCategories() {
    fetch('/admin/top-categories')
      .then(response => response.json())
      .then(data => renderTopItems('topCategories', data, 'category'))
      .catch(console.error);
  }

  // function loadTopPublishers() {
  //   fetch('/admin/top-publishers')
  //     .then(response => response.json())
  //     .then(data => renderTopItems('topPublishers', data, 'publisher'))
  //     .catch(console.error);
  // }

  function renderTopItems(containerId, items, type) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    items.slice(0, 10).forEach((item, index) => {
      const itemElement = document.createElement('div');
      itemElement.className = 'top-item';
      itemElement.innerHTML = `
        <div class="flex items-center gap-3">
          <div class="rank-badge">${index + 1}</div>
          <div>
            <p class="font-medium text-gray-800 text-sm">${item.name}</p>
            <p class="text-xs text-gray-500">${item.sales} sold</p>
          </div>
        </div>
        <div class="text-right">
          <p class="font-bold text-primary">â‚¹${item.revenue.toLocaleString()}</p>
        </div>`;
      container.appendChild(itemElement);
    });
  }

  // function loadRecentActivity() {
  //   fetch('/admin/recent-activity')
  //     .then(response => response.json())
  //     .then(renderRecentActivity)
  //     .catch(console.error);
  // }

  // function renderRecentActivity(activities) {
  //   const container = document.getElementById('recentActivity');
  //   container.innerHTML = '';
  //   activities.forEach(activity => {
  //     const el = document.createElement('div');
  //     el.className = 'flex items-center gap-4 p-3 bg-gray-50 rounded-lg';
  //     el.innerHTML = `
  //       <div class="flex-shrink-0">
  //         <div class="w-10 h-10 bg-primary-light rounded-full flex items-center justify-center">
  //           <i class="${activity.icon} text-primary"></i>
  //         </div>
  //       </div>
  //       <div class="flex-grow">
  //         <p class="text-sm font-medium text-gray-800">${activity.title}</p>
  //         <p class="text-xs text-gray-500">${activity.description}</p>
  //       </div>
  //       <div class="text-xs text-gray-400">${activity.time}</div>`;
  //     container.appendChild(el);
  //   });
  // }

  // Initial chart load
  updateSalesChart('30');
});
</script>
